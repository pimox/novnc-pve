<!DOCTYPE html>
<html>
<head>
    <title>noVNC</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <!-- Apple iOS Safari settings -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <!-- App Start Icon  -->
    <link rel="apple-touch-startup-image" href="images/screen_320x460.png" />
    <!-- For iOS devices set the icon to use if user bookmarks app on their homescreen -->
    <link rel="apple-touch-icon" href="images/screen_57x57.png">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="include/base.css" title="plain">

    <script src="include/util.js"></script>
</head>

<body style="margin: 0px;">
    <div id="noVNC_screen">
	    <div id="noVNC_status_state" style="margin-top: 0px; visibility: hidden; position: absolute;"></div>
	    <div id="noVNC_status_msg" style="margin-top: 0px; visibility: hidden; position: absolute;"></div>
            <canvas id="noVNC_canvas" width="640px" height="20px">
                Canvas not supported.
            </canvas>
        </div>

        <script>
        /*jslint white: false */
        /*global window, $, Util, RFB, */
        "use strict";

        // Load supporting scripts
        Util.load_scripts(["webutil.js", "base64.js", "websock.js", "des.js",
                           "keysymdef.js", "keyboard.js", "input.js", "display.js",
                           "jsunzip.js", "rfb.js"]);

        var rfb;

        function passwordRequired(rfb) {
            $D('noVNC_status_state').innerHTML = "pwrequest";
            $D('noVNC_status_msg').innerHTML = "needs password";
        }
        function setPassword() {
            //rfb.sendPassword($D('password_input').value);
            return false;
        }

	function updateState(rfb, state, oldstate, msg) {
            var sm, ss;
	    
            sm = $D('noVNC_status_msg');
            ss = $D('noVNC_status_state');
 
            if (state !== "normal") {
                xvpInit(0);
            }

            ss.innerHTML = state;

	    if (typeof(msg) !== 'undefined') {
              sm.innerHTML = msg;
	    }
        }

        function xvpInit(ver) {
	      // do nothing
        }

        window.onscriptsload = function () {
            var host, port, password, path, token;

            WebUtil.init_logging(WebUtil.getQueryVar('logging', 'warn'));
            document.title = unescape(WebUtil.getQueryVar('title', 'noVNC'));
            // By default, use the host and port of server that served this file
            host = WebUtil.getQueryVar('host', window.location.hostname);
            port = WebUtil.getQueryVar('port', window.location.port);
            password = WebUtil.getQueryVar('password', '');
            path = WebUtil.getQueryVar('path', 'websockify');

            if ((!host) || (!port)) {
                updateState('failed', "Must specify host and port in URL");
                return;
            }

            rfb = new RFB({'target':       $D('noVNC_canvas'),
                           'encrypt':      WebUtil.getQueryVar('encrypt',
                                    (window.location.protocol === "https:")),
                           'repeaterID':   WebUtil.getQueryVar('repeaterID', ''),
                           'true_color':   WebUtil.getQueryVar('true_color', true),
                           'local_cursor': WebUtil.getQueryVar('cursor', true),
                           'shared':       WebUtil.getQueryVar('shared', true),
                           'view_only':    WebUtil.getQueryVar('view_only', false),
                           'updateState':  updateState,
                           'onXvpInit':    xvpInit,
                           'onPasswordRequired':  passwordRequired});
            rfb.connect(host, port, password, path);
	    
	    $D("noVNC_screen").onmouseover = function(e) {
		window.focus();
	    };
        };
        </script>
    </body>
</html>
